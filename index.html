<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>Game Collection</title>
    <meta property="og:title" content="My Library">
    <meta property="og:description" content="Game collection tracker.">
    <meta property="og:image"
        content="https://raw.githubusercontent.com/seriouslyunderappreciated/seriouslyunderappreciated.github.io/master/resources/thumbnail.png">
    <meta property="og:url" content="https://seriouslyunderappreciated.github.io/">
    <link rel="stylesheet" type="text/css" href="resources/layout.css">
    <meta name="viewport" content="width=device-width,initial-scale=1" id="viewport-meta">
    <link rel="shortcut icon" href="resources/favicon.ico">
    <link rel="manifest" href="/manifest.json">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css?family=Merriweather:400,900,900i" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.31.3/js/jquery.tablesorter.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.31.3/js/jquery.tablesorter.widgets.min.js"></script>
</head>

<body>
    <div id='stars'></div>
    <div id='stars2'></div>
    <div id='stars3'></div>
    <main>
        <div style="text-align: center;"><img alt="Samus" src="resources/logo.png">
            <h1>My Games</h1>
            <p>This is purely how I figure out what to play next.</p>
            <p>Remakes <img alt="Remake" src="resources/hd.png"> and ports are listed under the release date of the
                original game for play order convenience.</p>
            <p>Full DLC and expansions are to be assumed, even if they are standalone releases.</p>
            <table id="myTable" class="dextable">
                <thead>
                    <tr>
                        <th class="fooevo sortable">Series</th>
                        <th class="fooevo hide-column">Release</th>
                        <!-- width to force other columns to wrap first -->
                        <th class="fooevo" style="width:40%;">Game</th>
                        <!-- min-width to account for img tag replacements -->
                        <th class="fooevo sortable nowrap"  style="min-width: 80px;">Device</th>
                        <th class="fooevo hide-column" data-value="!Yes">Done</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>

            <!-- Scroll to top button -->
            <a id="button"></a>

            <script>
                $(document).ready(function () {
                    // Custom parser for Device column
                    $.tablesorter.addParser({
                        id: 'deviceParser',
                        is: function () { return false; },
                        format: function (s, table, cell) {
                            return $(cell).attr('data-value') || '';
                        },
                        type: 'text'
                    });

                    $.get('resources/collection.csv', function (data) {
                        var lines = data.split('\n');
                        if (!lines || lines.length === 0) return;
                        var headers = lines[0].split(',');

                        for (var i = 1; i < lines.length; i++) {
                            if (!lines[i].trim()) continue; // skip empty lines
                            var row = lines[i].split(',');
                            if (row.length === headers.length) {
                                var tableRow = '<tr>';

                                for (var j = 0; j < headers.length; j++) {
                                    var cell = row[j].trim();
                                    // dataValue is the plain-text value used for filtering/sorting
                                    var dataValue = cell.replace(/\[hd\]|\[retro\]|\[switch\]/g, '').trim();

                                    // displayCell contains HTML image icons for flagged tokens
                                    var displayCell = cell
                                        .replace(/\[hd\]/g, '<img alt="Remake" title="Remake" src="resources/hd.png" class="icon">')
                                        .replace(/\[retro\]/g, '<img alt="Emulated" title="Emulated" src="resources/retro.png" class="icon">')
                                        .replace(/\[switch\]/g, '<img alt="Switch" title="Switch" src="resources/switch.png" class="icon">');

                                    // Hide Release and Done columns
                                    if (j === 1) { // Release column
                                        tableRow += '<td class="cen hide-column" data-value="' + dataValue + '">' + displayCell + '</td>';
                                    } else if (j === (headers.length - 1)) { // Done column (last column)
                                        tableRow += '<td class="cen hide-column" data-value="' + (cell === 'Yes' ? 'Yes' : '') + '">' + (cell === 'Yes' ? 'Yes' : '') + '</td>';
                                    } else if (j === 0 || j === 3) { // Series (0) or Device (3) columns -> nowrap
                                        tableRow += '<td class="cen nowrap" data-value="' + dataValue + '">' + displayCell + '</td>';
                                    } else { // All other columns
                                        tableRow += '<td class="cen" data-value="' + dataValue + '">' + displayCell + '</td>';
                                    }
                                }

                                tableRow += '</tr>';
                                $('#myTable tbody').append(tableRow);
                            }
                        }

                        var headerCount = $('#myTable thead th').length;
                        var headersConfig = {};
                        for (var c = 0; c < headerCount; c++) {
                            headersConfig[c] = { lockedOrder: 'asc' };
                        }

                        $('#myTable thead th').each(function (index) {
                            if (!$(this).hasClass('sortable')) {
                                headersConfig[index].sorter = false;
                            }
                        });

                        // Initialize tablesorter with custom parser for Device
                        $('#myTable').tablesorter({
                            sortList: [[0, 0], [1, 0], [2, 0]],
                            headers: $.extend(headersConfig, {
                                3: { sorter: 'deviceParser' }
                            }),
                            widgets: ["filter"],
                            widgetOptions: {
                                filter_defaultAttrib: 'data-value',
                                filter_columnFilters: true,
                                filter_columnAnyMatch: true
                            }
                        });
                    });

                    // Reset button
                    $('.resetsaved').click(function () {
                        $('.dextable').trigger('filterResetSaved');
                        var $message = $('<span class="results"> Reset</span>').insertAfter(this);
                        setTimeout(function () { $message.remove() }, 500);
                        return false;
                    });

                    // Column filter buttons
                    $('button[data-filter-column]').click(function () {
                        var filters = [],
                            $t = $(this),
                            col = $t.data('filter-column'),
                            txt = $t.data('filter-text') || $t.text();
                        filters[col] = txt;
                        $.tablesorter.setFilters($('.dextable'), filters, true);
                        return false;
                    });
                });
            </script>

        </div>
    </main>

    <script>
        // Scroll to top button
        var btn = $('#button');
        $(window).scroll(function () {
            if ($(window).scrollTop() > 300) {
                btn.addClass('show');
            } else {
                btn.removeClass('show');
            }
        });
        btn.on('click', function (e) {
            e.preventDefault();
            $('html, body').animate({ scrollTop: 0 }, '300');
        });
    </script>

</body>

</html>






